import{b as I,c as O,l as R}from"./index-Be1OEmQm.js";import{d as $,ag as L,R as J,S as X,c as u,e as g,w as f,f as n,E as Y,s as d,ah as A,o as c,x as S,X as B,Y as N,Z as T,b as t,a9 as Z,ab as j,_ as y,t as p,$ as G,q as V,ai as K,r as E,aa as P}from"./index-D5Rhts30.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"logs-view"},se={class:"card-header"},ae={class:"header-left"},te={class:"account-option"},le={class:"account-option-name"},oe={class:"header-right"},ne={class:"mode-switch"},ce={key:0,class:"connection-status"},re={class:"connection-text"},ie={key:1,class:"log-list"},ue={class:"log-time"},de={class:"log-tag"},ve={class:"log-message"},ge=$({__name:"LogsView",setup(fe){const _=d([]),l=d(null),o=d([]),r=d(!0),b=d(!1),v=d(!1),m=d(!0);let i=null,h=null;const W=async()=>{try{const s=await I.getAll();_.value=s.data,_.value.length>0&&!l.value&&(l.value=_.value[0].id)}catch(s){console.error("Failed to fetch accounts:",s)}},w=async()=>{if(l.value){b.value=!0;try{const s=await R.getHistorical(l.value,200);o.value=s.data.reverse(),m.value&&(await A(),x())}catch(s){console.error("Failed to fetch logs:",s)}finally{b.value=!1}}},k=()=>{l.value&&(C(),o.value=[],i=O(l.value),i.onopen=()=>{v.value=!0,console.log("WebSocket connected")},i.onmessage=s=>{try{const e=JSON.parse(s.data);o.value.push(e),o.value.length>500&&o.value.shift(),m.value&&A(()=>x())}catch(e){console.error("Failed to parse log:",e)}},i.onerror=s=>{console.error("WebSocket error:",s),v.value=!1},i.onclose=()=>{v.value=!1,console.log("WebSocket disconnected")})},C=()=>{i&&(i.close(),i=null),v.value=!1},x=()=>{h&&(h.scrollTop=h.scrollHeight)},z=()=>{o.value=[]},F=s=>({info:"log-info",warn:"log-warn",error:"log-error",debug:"log-debug"})[s]||"log-info",H=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),M=()=>{o.value=[],r.value?k():w()},U=()=>{r.value?k():(C(),w())},q=()=>{r.value?(o.value=[],k()):w()};return L(l,()=>{M()}),L(r,()=>{U()}),J(()=>{W().then(()=>{r.value&&l.value&&k()}),h=document.querySelector(".log-container")}),X(()=>{C()}),(s,e)=>(c(),u("div",ee,[g(n(Y),{shadow:"never",class:"logs-card"},{header:f(()=>[t("div",se,[t("div",ae,[e[4]||(e[4]=t("span",{class:"header-title"},"实时日志",-1)),g(n(Z),{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),placeholder:"选择账号",class:"account-select",clearable:""},{default:f(()=>[(c(!0),u(N,null,T(_.value,a=>(c(),S(n(P),{key:a.id,label:a.name,value:a.id},{default:f(()=>[t("div",te,[t("span",le,p(a.name),1),t("span",{class:y(["account-option-status",a.status==="running"?"status-running":"status-stopped"])},[e[3]||(e[3]=t("span",{class:"status-indicator"},null,-1)),E(" "+p(a.status==="running"?"运行中":"已停止"),1)],2)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",oe,[t("div",ne,[e[5]||(e[5]=t("span",{class:"switch-label"},"实时模式",-1)),g(n(j),{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a)},null,8,["modelValue"])]),r.value?(c(),u("div",ce,[t("span",{class:y(["connection-dot",v.value?"connected":"disconnected"])},null,2),t("span",re,p(v.value?"已连接":"未连接"),1)])):G("",!0),g(n(V),{icon:n(K),circle:"",size:"small",class:"refresh-btn",onClick:q},null,8,["icon"]),g(n(V),{size:"small",class:y(["scroll-btn",{"is-active":m.value}]),onClick:e[2]||(e[2]=a=>m.value=!m.value)},{default:f(()=>[...e[6]||(e[6]=[E(" 自动滚动 ",-1)])]),_:1},8,["class"]),g(n(V),{size:"small",class:"clear-btn",onClick:z},{default:f(()=>[...e[7]||(e[7]=[E(" 清空 ",-1)])]),_:1})])])]),default:f(()=>[l.value?(c(),u("div",{key:1,class:"log-container",ref_key:"logContainer",ref:h},[o.value.length===0&&!b.value?(c(),S(n(B),{key:0,description:"暂无日志",class:"empty-state"})):(c(),u("div",ie,[(c(!0),u(N,null,T(o.value,(a,D)=>(c(),u("div",{key:D,class:y(["log-entry",F(a.level)])},[t("span",ue,p(H(a.created_at)),1),t("span",de,"["+p(a.tag)+"]",1),t("span",ve,p(a.message),1)],2))),128))]))],512)):(c(),S(n(B),{key:0,description:"请先选择一个账号",class:"empty-state"}))]),_:1})]))}}),_e=Q(ge,[["__scopeId","data-v-237816fa"]]);export{_e as default};
