import{b as D,c as O,l as R}from"./index-Be1OEmQm.js";import{d as $,ah as x,Q as j,R as J,c as f,b as c,w as d,e as s,E as Q,r as g,ai as L,o as r,v as C,X as A,Y as T,Z as z,a as o,aa as X,ac as Y,A as Z,aj as G,ak as B,t as p,$ as K,p as S,al as P,q as V,ab as ee,_ as le}from"./index-DZf8Hpes.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"logs-view"},te={class:"card-header"},oe={class:"header-left"},ne={class:"header-right"},re={class:"mode-switch"},ce={key:0,class:"connection-status"},ie={key:1,class:"log-list"},ue={class:"log-time"},de={class:"log-tag"},ve={class:"log-message"},fe=$({__name:"LogsView",setup(ge){const _=g([]),t=g(null),n=g([]),i=g(!0),k=g(!1),v=g(!1),m=g(!0);let u=null,h=null;const N=async()=>{try{const l=await D.getAll();_.value=l.data,_.value.length>0&&!t.value&&(t.value=_.value[0].id)}catch(l){console.error("Failed to fetch accounts:",l)}},w=async()=>{if(t.value){k.value=!0;try{const l=await R.getHistorical(t.value,200);n.value=l.data.reverse(),m.value&&(await L(),E())}catch(l){console.error("Failed to fetch logs:",l)}finally{k.value=!1}}},y=()=>{t.value&&(b(),n.value=[],u=O(t.value),u.onopen=()=>{v.value=!0,console.log("WebSocket connected")},u.onmessage=l=>{try{const e=JSON.parse(l.data);n.value.push(e),n.value.length>500&&n.value.shift(),m.value&&L(()=>E())}catch(e){console.error("Failed to parse log:",e)}},u.onerror=l=>{console.error("WebSocket error:",l),v.value=!1},u.onclose=()=>{v.value=!1,console.log("WebSocket disconnected")})},b=()=>{u&&(u.close(),u=null),v.value=!1},E=()=>{h&&(h.scrollTop=h.scrollHeight)},W=()=>{n.value=[]},F=l=>({info:"log-info",warn:"log-warn",error:"log-error",debug:"log-debug"})[l]||"log-info",H=l=>new Date(l).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),I=()=>{n.value=[],i.value?y():w()},M=()=>{i.value?y():(b(),w())},U=()=>{i.value?(n.value=[],y()):w()};return x(t,()=>{I()}),x(i,()=>{M()}),j(()=>{N().then(()=>{i.value&&t.value&&y()}),h=document.querySelector(".log-container")}),J(()=>{b()}),(l,e)=>(r(),f("div",se,[c(s(Q),{shadow:"never",class:"logs-card"},{header:d(()=>[o("div",te,[o("div",oe,[e[3]||(e[3]=o("span",null,"实时日志",-1)),c(s(X),{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value=a),placeholder:"选择账号",style:{width:"200px"},clearable:""},{default:d(()=>[(r(!0),f(T,null,z(_.value,a=>(r(),C(s(ee),{key:a.id,label:a.name,value:a.id},{default:d(()=>[o("span",null,p(a.name),1),c(s(le),{size:"small",type:a.status==="running"?"success":"info",style:{"margin-left":"8px"}},{default:d(()=>[V(p(a.status==="running"?"运行中":"已停止"),1)]),_:2},1032,["type"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",ne,[o("div",re,[e[4]||(e[4]=o("span",{class:"switch-label"},"实时模式",-1)),c(s(Y),{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a)},null,8,["modelValue"])]),i.value?(r(),f("div",ce,[c(s(Z),{color:v.value?"#67c23a":"#909399"},{default:d(()=>[c(s(G))]),_:1},8,["color"]),o("span",{class:B(v.value?"connected":"disconnected")},p(v.value?"已连接":"未连接"),3)])):K("",!0),c(s(S),{icon:s(P),circle:"",size:"small",onClick:U},null,8,["icon"]),c(s(S),{size:"small",onClick:e[2]||(e[2]=a=>m.value=!m.value),type:m.value?"primary":"default"},{default:d(()=>[...e[5]||(e[5]=[V(" 自动滚动 ",-1)])]),_:1},8,["type"]),c(s(S),{size:"small",onClick:W},{default:d(()=>[...e[6]||(e[6]=[V(" 清空 ",-1)])]),_:1})])])]),default:d(()=>[t.value?(r(),f("div",{key:1,class:"log-container",ref_key:"logContainer",ref:h},[n.value.length===0&&!k.value?(r(),C(s(A),{key:0,description:"暂无日志"})):(r(),f("div",ie,[(r(!0),f(T,null,z(n.value,(a,q)=>(r(),f("div",{key:q,class:B(["log-entry",F(a.level)])},[o("span",ue,p(H(a.created_at)),1),o("span",de,"["+p(a.tag)+"]",1),o("span",ve,p(a.message),1)],2))),128))]))],512)):(r(),C(s(A),{key:0,description:"请先选择一个账号"}))]),_:1})]))}}),_e=ae(fe,[["__scopeId","data-v-cde94e66"]]);export{_e as default};
