import{b as f}from"./index-Be1OEmQm.js";import{d as Z,Q as h,c as z,b as s,w as o,e as a,a1 as N,r as d,O as ee,s as r,P as ae,o as b,a2 as le,v as $,a3 as v,_ as P,q as u,t as q,a4 as te,p as g,a0 as se,V as oe,a5 as ne,$ as B,a6 as re,a7 as ue,a8 as de,a as p,a9 as ie,h as fe,j as c,k as L,aa as me,ab as M,ac as R,ad as F,ae as pe,af as ce,ag as ve}from"./index-DZf8Hpes.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"accounts-view"},ye={class:"card-header"},Ve={class:"qr-container"},be={key:1,class:"qr-status"},qe=Z({__name:"AccountsView",setup(Ce){const U=d(!1),S=d([]),_=d(!1),C=d(!1),E=d(!1),w=d(null),n=d({name:"",platform:"qq",code:"",auto_start:!1,farm_interval:10,friend_interval:10,enable_steal:!0,force_lowest:!1}),k=d(null),I=d(!1),T=d(null);let x=null;const Q=d(!1),O=ee(()=>E.value?"编辑账号":"添加账号"),y=async()=>{U.value=!0;try{const l=await f.getAll();S.value=l.data}catch{r.error("获取账号列表失败")}finally{U.value=!1}},j=()=>{E.value=!1,w.value=null,n.value={name:"",platform:"qq",code:"",auto_start:!1,farm_interval:10,friend_interval:10,enable_steal:!0,force_lowest:!1},_.value=!0},G=l=>{E.value=!0,w.value=l.id,n.value={name:l.name,platform:l.platform,code:l.code,auto_start:l.auto_start,farm_interval:l.farm_interval,friend_interval:l.friend_interval,enable_steal:l.enable_steal,force_lowest:l.force_lowest},_.value=!0},H=async()=>{try{E.value&&w.value?(await f.update(w.value,n.value),r.success("更新成功")):(await f.create(n.value),r.success("添加成功")),_.value=!1,y()}catch(l){const e=l.response?.data?.error||"操作失败";r.error(e)}},J=async l=>{try{await ce.confirm(`确定要删除账号 "${l.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await f.delete(l.id),r.success("删除成功"),y()}catch(e){if(e!=="cancel"){const i=e.response?.data?.error||"删除失败";r.error(i)}}},K=async l=>{try{if(l.status==="running")await f.stop(l.id),r.success(`已停止 ${l.name}`);else{if(l.platform==="qq"&&!l.code){Q.value=!0,A(l);return}await f.start(l.id),r.success(`已启动 ${l.name}`)}y()}catch(e){const i=e.response?.data?.error||"操作失败";r.error(i)}},A=async l=>{try{const e=await f.getQRCode(l.id);k.value=e.data,T.value=l.id,C.value=!0,W(l.id,e.data.login_code)}catch(e){const i=e.response?.data?.error||"获取二维码失败";r.error(i)}},W=(l,e)=>{I.value=!0,x=window.setInterval(async()=>{try{const m=(await f.pollQRCode(l,e)).data;if(m.status==="ok"&&m.code){if(await f.update(l,{code:m.code}),r.success("扫码登录成功！"),D(),Q.value){Q.value=!1;try{await f.start(l),r.success("已自动启动")}catch(t){const V=t.response?.data?.error||"自动启动失败";r.error(V)}}y()}else m.status==="expired"?(r.warning("二维码已过期，请重新获取"),D()):m.status==="error"&&(r.error(m.message||"扫码登录失败"),D())}catch(i){console.error("QR polling error:",i)}},2e3)},D=()=>{C.value=!1,k.value=null,T.value=null,Q.value=!1,x&&(clearInterval(x),x=null),I.value=!1},X=l=>l==="running"?"success":l==="error"?"danger":"info",Y=l=>l==="running"?"运行中":l==="error"?"错误":"已停止";return h(()=>{y()}),(l,e)=>{const i=ae("ElCard"),m=ve("loading");return b(),z("div",_e,[s(i,{shadow:"never",class:"table-card"},{header:o(()=>[p("div",ye,[e[12]||(e[12]=p("span",null,"账号列表",-1)),s(a(g),{type:"primary",icon:a(ie),onClick:j},{default:o(()=>[...e[11]||(e[11]=[u(" 添加账号 ",-1)])]),_:1},8,["icon"])])]),default:o(()=>[le((b(),$(a(de),{data:S.value,stripe:"",style:{width:"100%"}},{default:o(()=>[s(a(v),{prop:"id",label:"ID",width:"70"}),s(a(v),{prop:"name",label:"名称","min-width":"120"}),s(a(v),{prop:"platform",label:"平台",width:"80"},{default:o(({row:t})=>[s(a(P),{size:"small",type:t.platform==="qq"?"primary":"success"},{default:o(()=>[u(q(t.platform.toUpperCase()),1)]),_:2},1032,["type"])]),_:1}),s(a(v),{prop:"status",label:"状态",width:"100"},{default:o(({row:t})=>[s(a(P),{type:X(t.status),size:"small"},{default:o(()=>[u(q(Y(t.status)),1)]),_:2},1032,["type"])]),_:1}),s(a(v),{prop:"level",label:"等级",width:"80"},{default:o(({row:t})=>[u(" Lv."+q(t.level||0),1)]),_:1}),s(a(v),{prop:"gold",label:"金币",width:"100"},{default:o(({row:t})=>[u(q((t.gold||0).toLocaleString()),1)]),_:1}),s(a(v),{label:"操作",width:"280",fixed:"right"},{default:o(({row:t})=>[s(a(te),null,{default:o(()=>[s(a(g),{type:t.status==="running"?"danger":"success",size:"small",icon:t.status==="running"?a(se):a(oe),onClick:V=>K(t)},{default:o(()=>[u(q(t.status==="running"?"停止":"启动"),1)]),_:2},1032,["type","icon","onClick"]),t.platform==="qq"?(b(),$(a(g),{key:0,type:"warning",size:"small",icon:a(ne),onClick:V=>A(t)},{default:o(()=>[...e[13]||(e[13]=[u(" 扫码 ",-1)])]),_:1},8,["icon","onClick"])):B("",!0),s(a(g),{type:"primary",size:"small",icon:a(re),onClick:V=>G(t)},{default:o(()=>[...e[14]||(e[14]=[u(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),s(a(g),{type:"danger",size:"small",icon:a(ue),onClick:V=>J(t)},{default:o(()=>[...e[15]||(e[15]=[u(" 删除 ",-1)])]),_:1},8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[m,U.value]])]),_:1}),s(a(N),{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=t=>_.value=t),title:O.value,width:"500px","destroy-on-close":""},{footer:o(()=>[s(a(g),{onClick:e[8]||(e[8]=t=>_.value=!1)},{default:o(()=>[...e[19]||(e[19]=[u("取消",-1)])]),_:1}),s(a(g),{type:"primary",onClick:H},{default:o(()=>[...e[20]||(e[20]=[u("确定",-1)])]),_:1})]),default:o(()=>[s(a(fe),{model:n.value,"label-width":"100px"},{default:o(()=>[s(a(c),{label:"名称",required:""},{default:o(()=>[s(a(L),{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.name=t),placeholder:"请输入账号名称"},null,8,["modelValue"])]),_:1}),s(a(c),{label:"平台",required:""},{default:o(()=>[s(a(me),{modelValue:n.value.platform,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.platform=t),style:{width:"100%"}},{default:o(()=>[s(a(M),{label:"QQ小程序",value:"qq"}),s(a(M),{label:"微信小程序",value:"wx"})]),_:1},8,["modelValue"])]),_:1}),s(a(c),{label:"登录Code"},{default:o(()=>[s(a(L),{modelValue:n.value.code,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.code=t),placeholder:"请输入登录Code（QQ可扫码获取）",type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),s(a(c),{label:"自动启动"},{default:o(()=>[s(a(R),{modelValue:n.value.auto_start,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.auto_start=t)},null,8,["modelValue"])]),_:1}),s(a(c),{label:"农场间隔"},{default:o(()=>[s(a(F),{modelValue:n.value.farm_interval,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.farm_interval=t),min:1,max:60,style:{width:"100%"}},null,8,["modelValue"]),e[16]||(e[16]=p("span",{class:"form-hint"},"秒",-1))]),_:1}),s(a(c),{label:"好友间隔"},{default:o(()=>[s(a(F),{modelValue:n.value.friend_interval,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.friend_interval=t),min:1,max:60,style:{width:"100%"}},null,8,["modelValue"]),e[17]||(e[17]=p("span",{class:"form-hint"},"秒",-1))]),_:1}),s(a(c),{label:"允许偷菜"},{default:o(()=>[s(a(R),{modelValue:n.value.enable_steal,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.enable_steal=t)},null,8,["modelValue"])]),_:1}),s(a(c),{label:"强制最低级"},{default:o(()=>[s(a(R),{modelValue:n.value.force_lowest,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.force_lowest=t)},null,8,["modelValue"]),e[18]||(e[18]=p("span",{class:"form-hint"},"种植最低等级作物",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),s(a(N),{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=t=>C.value=t),title:"扫码登录",width:"400px",onClose:D},{default:o(()=>[p("div",Ve,[e[22]||(e[22]=p("p",{class:"qr-tip"},"请使用手机QQ扫描下方二维码登录",-1)),k.value?(b(),$(a(pe),{key:0,src:`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(k.value.qr_code_url)}`,fit:"contain",class:"qr-image"},null,8,["src"])):B("",!0),I.value?(b(),z("p",be,[...e[21]||(e[21]=[p("span",{class:"waiting-dot"},null,-1),u(" 等待扫码中... ",-1)])])):B("",!0)])]),_:1},8,["modelValue"])])}}}),xe=ge(qe,[["__scopeId","data-v-16b71113"]]);export{xe as default};
