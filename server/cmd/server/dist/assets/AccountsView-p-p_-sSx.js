import{b as c}from"./index-Be1OEmQm.js";import{d as X,R as Y,c as T,e as s,w as o,f as l,a1 as z,s as i,P as Z,v as u,Q as ee,o as q,a2 as ae,x as R,a3 as v,b as r,t as b,_ as N,q as _,a0 as le,V as te,r as m,a4 as se,$,a5 as oe,a6 as ne,a7 as re,a8 as ue,i as ie,k as p,l as P,a9 as de,aa as L,ab as B,ac as M,ad as ce,ae as fe,af as me}from"./index-D5Rhts30.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"accounts-view"},_e={class:"card-header"},ge={class:"account-name"},be={class:"status-text"},Ve={class:"level-value"},ye={class:"gold-value"},qe={class:"action-buttons"},Ce={class:"interval-input"},xe={class:"interval-input"},we={class:"switch-row"},ke={class:"dialog-footer"},Ee={class:"qr-container"},Qe={class:"qr-image-wrapper"},De={key:0,class:"qr-status"},Ue=X({__name:"AccountsView",setup(Ie){const U=i(!1),A=i([]),g=i(!1),C=i(!1),x=i(!1),w=i(null),n=i({name:"",platform:"qq",code:"",auto_start:!1,farm_interval:10,friend_interval:10,enable_steal:!0,force_lowest:!1}),k=i(null),I=i(!1),h=i(null);let E=null;const Q=i(!1),F=Z(()=>x.value?"编辑账号":"添加账号"),V=async()=>{U.value=!0;try{const t=await c.getAll();A.value=t.data}catch{u.error("获取账号列表失败")}finally{U.value=!1}},O=()=>{x.value=!1,w.value=null,n.value={name:"",platform:"qq",code:"",auto_start:!1,farm_interval:10,friend_interval:10,enable_steal:!0,force_lowest:!1},g.value=!0},j=t=>{x.value=!0,w.value=t.id,n.value={name:t.name,platform:t.platform,code:t.code,auto_start:t.auto_start,farm_interval:t.farm_interval,friend_interval:t.friend_interval,enable_steal:t.enable_steal,force_lowest:t.force_lowest},g.value=!0},G=async()=>{try{x.value&&w.value?(await c.update(w.value,n.value),u.success("更新成功")):(await c.create(n.value),u.success("添加成功")),g.value=!1,V()}catch(t){const e=t.response?.data?.error||"操作失败";u.error(e)}},H=async t=>{try{await fe.confirm(`确定要删除账号 "${t.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await c.delete(t.id),u.success("删除成功"),V()}catch(e){if(e!=="cancel"){const d=e.response?.data?.error||"删除失败";u.error(d)}}},J=async t=>{try{if(t.status==="running")await c.stop(t.id),u.success(`已停止 ${t.name}`);else{if(t.platform==="qq"&&!t.code){Q.value=!0,S(t);return}await c.start(t.id),u.success(`已启动 ${t.name}`)}V()}catch(e){const d=e.response?.data?.error||"操作失败";u.error(d)}},S=async t=>{try{const e=await c.getQRCode(t.id);k.value=e.data,h.value=t.id,C.value=!0,K(t.id,e.data.login_code)}catch(e){const d=e.response?.data?.error||"获取二维码失败";u.error(d)}},K=(t,e)=>{I.value=!0,E=window.setInterval(async()=>{try{const f=(await c.pollQRCode(t,e)).data;if(f.status==="ok"&&f.code){if(await c.update(t,{code:f.code}),u.success("扫码登录成功！"),D(),Q.value){Q.value=!1;try{await c.start(t),u.success("已自动启动")}catch(a){const y=a.response?.data?.error||"自动启动失败";u.error(y)}}V()}else f.status==="expired"?(u.warning("二维码已过期，请重新获取"),D()):f.status==="error"&&(u.error(f.message||"扫码登录失败"),D())}catch(d){console.error("QR polling error:",d)}},2e3)},D=()=>{C.value=!1,k.value=null,h.value=null,Q.value=!1,E&&(clearInterval(E),E=null),I.value=!1},W=t=>t==="running"?"运行中":t==="error"?"错误":"已停止";return Y(()=>{V()}),(t,e)=>{const d=ee("ElCard"),f=me("loading");return q(),T("div",ve,[s(d,{shadow:"never",class:"table-card"},{header:o(()=>[r("div",_e,[e[12]||(e[12]=r("span",{class:"header-title"},"账号列表",-1)),s(l(_),{type:"primary",icon:l(ue),onClick:O,class:"add-btn"},{default:o(()=>[...e[11]||(e[11]=[m(" 添加账号 ",-1)])]),_:1},8,["icon"])])]),default:o(()=>[ae((q(),R(l(re),{data:A.value,class:"accounts-table",style:{width:"100%"}},{default:o(()=>[s(l(v),{prop:"id",label:"ID",width:"70",align:"center"}),s(l(v),{prop:"name",label:"名称","min-width":"120"},{default:o(({row:a})=>[r("span",ge,b(a.name),1)]),_:1}),s(l(v),{prop:"platform",label:"平台",width:"90",align:"center"},{default:o(({row:a})=>[r("span",{class:N(["platform-badge",a.platform==="qq"?"platform-qq":"platform-wx"])},b(a.platform.toUpperCase()),3)]),_:1}),s(l(v),{prop:"status",label:"状态",width:"100",align:"center"},{default:o(({row:a})=>[r("div",{class:N(["status-tag","status-"+a.status])},[e[13]||(e[13]=r("span",{class:"status-dot"},null,-1)),r("span",be,b(W(a.status)),1)],2)]),_:1}),s(l(v),{prop:"level",label:"等级",width:"80",align:"center"},{default:o(({row:a})=>[r("span",Ve,"Lv."+b(a.level||0),1)]),_:1}),s(l(v),{prop:"gold",label:"金币",width:"110",align:"right"},{default:o(({row:a})=>[r("span",ye,b((a.gold||0).toLocaleString()),1)]),_:1}),s(l(v),{label:"操作",width:"260",fixed:"right",align:"center"},{default:o(({row:a})=>[r("div",qe,[s(l(_),{type:a.status==="running"?"danger":"success",size:"small",icon:a.status==="running"?l(le):l(te),onClick:y=>J(a),class:"action-btn action-btn--toggle"},{default:o(()=>[m(b(a.status==="running"?"停止":"启动"),1)]),_:2},1032,["type","icon","onClick"]),a.platform==="qq"?(q(),R(l(_),{key:0,size:"small",icon:l(se),onClick:y=>S(a),class:"action-btn action-btn--qr"},{default:o(()=>[...e[14]||(e[14]=[m(" 扫码 ",-1)])]),_:1},8,["icon","onClick"])):$("",!0),s(l(_),{size:"small",text:"",icon:l(oe),onClick:y=>j(a),class:"action-btn action-btn--edit"},{default:o(()=>[...e[15]||(e[15]=[m(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),s(l(_),{size:"small",text:"",icon:l(ne),onClick:y=>H(a),class:"action-btn action-btn--delete"},{default:o(()=>[...e[16]||(e[16]=[m(" 删除 ",-1)])]),_:1},8,["icon","onClick"])])]),_:1})]),_:1},8,["data"])),[[f,U.value]])]),_:1}),s(l(z),{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=a=>g.value=a),title:F.value,width:"500px","destroy-on-close":"",class:"account-dialog"},{footer:o(()=>[r("div",ke,[s(l(_),{onClick:e[8]||(e[8]=a=>g.value=!1),class:"btn-cancel"},{default:o(()=>[...e[20]||(e[20]=[m("取消",-1)])]),_:1}),s(l(_),{type:"primary",onClick:G,class:"btn-submit"},{default:o(()=>[...e[21]||(e[21]=[m("确定",-1)])]),_:1})])]),default:o(()=>[s(l(ie),{model:n.value,"label-width":"100px",class:"account-form"},{default:o(()=>[s(l(p),{label:"名称",required:""},{default:o(()=>[s(l(P),{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.name=a),placeholder:"请输入账号名称"},null,8,["modelValue"])]),_:1}),s(l(p),{label:"平台",required:""},{default:o(()=>[s(l(de),{modelValue:n.value.platform,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.platform=a),style:{width:"100%"}},{default:o(()=>[s(l(L),{label:"QQ小程序",value:"qq"}),s(l(L),{label:"微信小程序",value:"wx"})]),_:1},8,["modelValue"])]),_:1}),s(l(p),{label:"登录Code"},{default:o(()=>[s(l(P),{modelValue:n.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.code=a),placeholder:"请输入登录Code（QQ可扫码获取）",type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),s(l(p),{label:"自动启动"},{default:o(()=>[s(l(B),{modelValue:n.value.auto_start,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.auto_start=a)},null,8,["modelValue"])]),_:1}),s(l(p),{label:"农场间隔"},{default:o(()=>[r("div",Ce,[s(l(M),{modelValue:n.value.farm_interval,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.farm_interval=a),min:1,max:60,style:{width:"120px"}},null,8,["modelValue"]),e[17]||(e[17]=r("span",{class:"form-hint"},"秒",-1))])]),_:1}),s(l(p),{label:"好友间隔"},{default:o(()=>[r("div",xe,[s(l(M),{modelValue:n.value.friend_interval,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.friend_interval=a),min:1,max:60,style:{width:"120px"}},null,8,["modelValue"]),e[18]||(e[18]=r("span",{class:"form-hint"},"秒",-1))])]),_:1}),s(l(p),{label:"允许偷菜"},{default:o(()=>[s(l(B),{modelValue:n.value.enable_steal,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.enable_steal=a)},null,8,["modelValue"])]),_:1}),s(l(p),{label:"强制最低级"},{default:o(()=>[r("div",we,[s(l(B),{modelValue:n.value.force_lowest,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.force_lowest=a)},null,8,["modelValue"]),e[19]||(e[19]=r("span",{class:"form-hint"},"种植最低等级作物",-1))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),s(l(z),{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=a=>C.value=a),title:"扫码登录",width:"400px",onClose:D,class:"qr-dialog"},{default:o(()=>[r("div",Ee,[e[23]||(e[23]=r("p",{class:"qr-tip"},"请使用手机QQ扫描下方二维码登录",-1)),r("div",Qe,[k.value?(q(),R(l(ce),{key:0,src:`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(k.value.qr_code_url)}`,fit:"contain",class:"qr-image"},null,8,["src"])):$("",!0)]),I.value?(q(),T("p",De,[...e[22]||(e[22]=[r("span",{class:"waiting-dot"},null,-1),m(" 等待扫码中... ",-1)])])):$("",!0)])]),_:1},8,["modelValue"])])}}}),Ae=pe(Ue,[["__scopeId","data-v-fe6407bf"]]);export{Ae as default};
